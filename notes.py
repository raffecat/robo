#!/usr/bin/env python3

import math

freq = [

# C0
16.35,
17.32,
18.35,
19.45,
20.60,
21.83,
23.12,
24.50,
25.96,
27.50,
29.14,
30.87,

# C1
32.70,  
34.65,  
36.71,  
38.89,  
41.20,  
43.65,  
46.25,  
49.00,     
51.91,  
55.00,     
58.27,  
61.74,  

# C2
65.41,  
69.30,  
73.42,  
77.78,  
82.41,  
87.31,  
92.50,  
98.00,     
103.83, 
110.00,    
116.54, 
123.47, 

# C3
130.81, 
138.59, 
146.83, 
155.56, 
164.81, 
174.61, 
185.00,    
196.00,    
207.65, 
220.00,    
233.08, 
246.94, 

# C4
261.63, 
277.18, 
293.66, 
311.13, 
329.63, 
349.23, 
369.99, 
392.00,
415.30, 
440.00,
466.16, 
493.88, 

# C5
523.25, 
554.37, 
587.33, 
622.25, 
659.25, 
698.46, 
739.99, 
783.99, 
830.61, 
880.00, 
932.33, 
987.77, 

# C6
1046.50, 
1108.73, 
1174.66, 
1244.51, 
1318.51, 
1396.91, 
1479.98, 
1567.98, 
1661.22, 
1760.00,
1864.66, 
1975.53, 

# C7
2093.00,
2217.46,
2349.32,
2489.02,
2637.02,
2793.83,
2959.96,
3135.96,
3322.44,
3520.00,
3729.31,
3951.07,

# C8
4186.01,
4434.92,
4698.63,
4978.03,
5274.04,
5587.65,
5919.91,
6271.93,
6644.88,
7040.00,
7458.62,
7902.13,

]

notes = [
"C ",
"C#",
"D ",
"D#",
"E ",
"F ",
"F#",
"G ",
"G#",
"A ",
"A#",
"B ",
]


# In-tune: 2C (65.41 Hz) -> 6F (1396.91 Hz)    2 3 4 5 6

crystal = 14381800 / 14   # NTSC crystal with divider counter
cycle = 16                # Number of ticks per cycle in the wave generator (acts as divider)

print(f"crystal {crystal}")

octv = 0
n = 0
for f in range(0,len(freq)):
    freq_true = freq[f]
    freq_clk = freq_true * cycle
    num = crystal / freq_clk
    note = notes[f%12]
    divis = int(num)
    if math.fmod(num,1.0) >= 0.5:
        divis += 1 # round up
    error = abs(divis - num)
    output = crystal / divis
    out_err = output - freq_clk
    print(f"{octv}{note}  {freq_true} * {cycle} = {freq_clk}  \t@ {divis} = {output:.3f} ({out_err/cycle:+.2f} cyc)     \t({num:.3f}) {error:.2f}")
    n = n + 1
    if n >= len(notes):
        n = 0
        octv = octv + 1


#  C       16.35 Hz    32.70 Hz    65.41 Hz    130.81 Hz   261.63 Hz   523.25 Hz   1046.50 Hz  2093.00 Hz  4186.01 Hz
#  C#/Db   17.32 Hz    34.65 Hz    69.30 Hz    138.59 Hz   277.18 Hz   554.37 Hz   1108.73 Hz  2217.46 Hz  4434.92 Hz
#  D       18.35 Hz    36.71 Hz    73.42 Hz    146.83 Hz   293.66 Hz   587.33 Hz   1174.66 Hz  2349.32 Hz  4698.63 Hz
#  D#/Eb   19.45 Hz    38.89 Hz    77.78 Hz    155.56 Hz   311.13 Hz   622.25 Hz   1244.51 Hz  2489.02 Hz  4978.03 Hz
#  E       20.60 Hz    41.20 Hz    82.41 Hz    164.81 Hz   329.63 Hz   659.25 Hz   1318.51 Hz  2637.02 Hz  5274.04 Hz
#  F       21.83 Hz    43.65 Hz    87.31 Hz    174.61 Hz   349.23 Hz   698.46 Hz   1396.91 Hz  2793.83 Hz  5587.65 Hz
#  F#/Gb   23.12 Hz    46.25 Hz    92.50 Hz    185 Hz      369.99 Hz   739.99 Hz   1479.98 Hz  2959.96 Hz  5919.91 Hz
#  G       24.50 Hz    49 Hz       98 Hz       196 Hz      392 Hz      783.99 Hz   1567.98 Hz  3135.96 Hz  6271.93 Hz
#  G#/Ab   25.96 Hz    51.91 Hz    103.83 Hz   207.65 Hz   415.30 Hz   830.61 Hz   1661.22 Hz  3322.44 Hz  6644.88 Hz
#  A       27.50 Hz    55 Hz       110 Hz      220 Hz      440 Hz      880 Hz      1760 Hz     3520 Hz     7040 Hz
#  A#/Bb   29.14 Hz    58.27 Hz    116.54 Hz   233.08 Hz   466.16 Hz   932.33 Hz   1864.66 Hz  3729.31 Hz  7458.62 Hz
#  B       30.87 Hz    61.74 Hz    123.47 Hz   246.94 Hz   493.88 Hz   987.77 Hz   1975.53 Hz  3951.07 Hz  7902.13 Hz
